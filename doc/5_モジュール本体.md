# 5 モジュール本体

モジュール本体（セクション 4.2）には、本仕様で定義する VBA プログラミング言語の構文で記述されたソースコードが含まれる。本章では、モジュール本体の有効な構文、静的セマンティクス、実行時セマンティクスを定義する。

構文は、セクション 3 で定義された終端記号を組み込んだ ABNF [[RFC4234]](https://go.microsoft.com/fwlink/?LinkId=90462) 文法を用いて記述される。`<LINE-START>` と `<LINE-END>` 要素を明示的に識別する場合を除き、この文法はモジュール本体のソースコードを含むファイルの物理的な行構造を無視する。この文法は、セクション 3.4 で説明するように、条件付きコンパイル指示文と条件付き除外ソースコードも無視する。この文法は前処理されたモジュール本体（セクション 3.4）に適用され、ソースコードは字句トークン化と条件付きコンパイルの両方の前処理が適用されたかのように解釈される。この前処理は本仕様を単純化し明確にするためにのみなされる。実装が実際にこのような処理モデルを使用する必要はない。

## 5.1 モジュール本体の構造

```
procedural-module-body = LINE-START  procedural-module-declaration-section
                         LINE-START  procedural-module-code-section

class-module-body = LINE-START  class-module-declaration-section
                    LINE-START  class-module-code-section
```

プロシージャモジュール（セクション 4.2）とクラスモジュール（セクション 4.2）はともに、宣言部（セクション 5.2）とコード部（セクション 5.3）の二つの部分からなるモジュール本体（セクション 4.2）を持っている。各部分は、それを含むソースファイルの物理的な行の最初の構文要素として<ins>出現しなければならない</ins>。

本仕様では、様々な形式のエンティティ（セクション 2.2）名を表現するために以下の共通文法規則を使用する。

```
unrestricted-name = name / reserved-identifier
name = untyped-name / TYPED-NAME
untyped-name = IDENTIFIER / FOREIGN-NAME
```

## 5.2 モジュール宣言部の構造

モジュール（セクション 4.2）の宣言部は、ディレクティブと宣言から構成される。一般的に、ディレクティブはモジュール内の静的セマンティクスの適用を制御する。宣言はプログラムの実行環境内に存在する名前付きエンティティを定義する。

```
procedural-module-declaration-section = [*(procedural-module-directive-element EOS) def-directive]  *( procedural-module-declaration-element EOS)
class-module-declaration-section = [*(class-module-directive-element EOS) def-directive]  *(class-module-declaration-element EOS)
procedural-module-directive-element = common-option-directive / option-private-directive / def-directive 
procedural-module-declaration-element = common-module-declaration-element / global-variable-declaration / public-const-declaration / public-type-declaration / public-external-procedure-declaration / global-enum-declaration / common-option-directive / option-private-directive

class-module-directive-element = common-option-directive / def-directive / implements-directive
class-module-declaration-element = common-module-declaration-element / event-declaration / commonoption-directive / implements-directive 
```

静的セマンティクス

モジュール宣言部の中でのディレクティブと宣言の出現回数と相対的な順序には様々な制限がある。これらの制限は、個々のディレクティブと宣言の要素の定義の一部として指定される。

### 5.2.1 Option ディレクティブ

`Option` ディレクティブは、様々な言語機能の代替セマンティクスを選択するために使用される。

```
common-option-directive = option-compare-directive /  option-base-directive / option-explicit-directive  / rem-statement
```

静的セマンティクス

- 各 `<common-option-directive>` は、各 `<procedural-module-declaration-section>` または `<class-module-declaration-section>` に最大 1 回まで出現することが可能である。
- `<option-private-directive>` は、各 `<procedural-module-declaration-section>` に最大 1 回まで出現することが可能である。

#### 5.2.1.1 Option Compare ディレクティブ

`Option Compare` ディレクティブは、関係演算子（セクション 5.6.9.5）がモジュール（セクション 4.2）内の文字列データ値（セクション 2.1）に適用される際の比較規則を決定する。これはモジュールの比較モードとして知られている。

```
option-compare-directive = "Option"   "Compare"   ( "Binary" / "Text")
```

静的セマンティクス

- `<option-compare-directive>` が `Binary` キーワード（セクション 3.3.5.1）を含んでいる場合、モジュールの比較モードはバイナリ比較モードになる。
- `<option-compare-directive>` が `Text` キーワードを含んでいる場合、モジュールの比較モードはテキスト比較モードになる。
- `<option-compare-directive>` は `<procedural-module-declaration-section>` や `<class-module-declaration-section>` 内に 1 つだけ存在できる。
- `<procedural-module-declaration-section>` または `<class-module-declaration-section>` が `<option-compare-directive>` を含んでいない場合、そのモジュールの比較モードはバイナリ比較モードとなる。
